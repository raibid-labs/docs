<!DOCTYPE html>
<html lang="en" dir="ltr"><head><title>grafana-stack-examples</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;family=IBM Plex Mono:wght@400;600&amp;display=swap"/><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="Raibid Labs Documentation"/><meta property="og:title" content="grafana-stack-examples"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="grafana-stack-examples"/><meta name="twitter:description" content="Grafana Observability Stack with Tanka: Concrete Examples Overview This document provides production-ready examples for deploying the complete Grafana observability stack using Tanka and Jsonnet, including Loki, Mimir, Tempo, Prometheus, and Grafana."/><meta property="og:description" content="Grafana Observability Stack with Tanka: Concrete Examples Overview This document provides production-ready examples for deploying the complete Grafana observability stack using Tanka and Jsonnet, including Loki, Mimir, Tempo, Prometheus, and Grafana."/><meta property="og:image:alt" content="Grafana Observability Stack with Tanka: Concrete Examples Overview This document provides production-ready examples for deploying the complete Grafana observability stack using Tanka and Jsonnet, including Loki, Mimir, Tempo, Prometheus, and Grafana."/><meta property="twitter:domain" content="raibid-labs.github.io/docs"/><meta property="og:url" content="https://raibid-labs.github.io/docs/projects/mop/docs/research/grafana-stack-examples"/><meta property="twitter:url" content="https://raibid-labs.github.io/docs/projects/mop/docs/research/grafana-stack-examples"/><link rel="icon" href="../../../../static/icon.png"/><meta name="description" content="Grafana Observability Stack with Tanka: Concrete Examples Overview This document provides production-ready examples for deploying the complete Grafana observability stack using Tanka and Jsonnet, including Loki, Mimir, Tempo, Prometheus, and Grafana."/><meta name="generator" content="Quartz"/><link href="../../../../index.css" rel="stylesheet" type="text/css" spa-preserve/><style>.expand-button {
  position: absolute;
  display: flex;
  float: right;
  padding: 0.4rem;
  margin: 0.3rem;
  right: 0;
  color: var(--gray);
  border-color: var(--dark);
  background-color: var(--light);
  border: 1px solid;
  border-radius: 5px;
  opacity: 0;
  transition: 0.2s;
}
.expand-button > svg {
  fill: var(--light);
  filter: contrast(0.3);
}
.expand-button:hover {
  cursor: pointer;
  border-color: var(--secondary);
}
.expand-button:focus {
  outline: 0;
}

pre:hover > .expand-button {
  opacity: 1;
  transition: 0.2s;
}

#mermaid-container {
  position: fixed;
  contain: layout;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  display: none;
  backdrop-filter: blur(4px);
  background: rgba(0, 0, 0, 0.5);
}
#mermaid-container.active {
  display: inline-block;
}
#mermaid-container > #mermaid-space {
  border: 1px solid var(--lightgray);
  background-color: var(--light);
  border-radius: 5px;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  height: 80vh;
  width: 80vw;
  overflow: hidden;
}
#mermaid-container > #mermaid-space > .mermaid-content {
  padding: 2rem;
  position: relative;
  transform-origin: 0 0;
  transition: transform 0.1s ease;
  overflow: visible;
  min-height: 200px;
  min-width: 200px;
}
#mermaid-container > #mermaid-space > .mermaid-content pre {
  margin: 0;
  border: none;
}
#mermaid-container > #mermaid-space > .mermaid-content svg {
  max-width: none;
  height: auto;
}
#mermaid-container > #mermaid-space > .mermaid-controls {
  position: absolute;
  bottom: 20px;
  right: 20px;
  display: flex;
  gap: 8px;
  padding: 8px;
  background: var(--light);
  border: 1px solid var(--lightgray);
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  z-index: 2;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  border: 1px solid var(--lightgray);
  background: var(--light);
  color: var(--dark);
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
  font-family: var(--bodyFont);
  transition: all 0.2s ease;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:hover {
  background: var(--lightgray);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:active {
  transform: translateY(1px);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:nth-child(2) {
  width: auto;
  padding: 0 12px;
  font-size: 14px;
}
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiL2hvbWUvcnVubmVyL3dvcmsvZG9jcy9kb2NzL3F1YXJ0ei9jb21wb25lbnRzL3N0eWxlcyIsInNvdXJjZXMiOlsibWVybWFpZC5pbmxpbmUuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7RUFDQTs7QUFHRjtFQUNFO0VBQ0E7O0FBR0Y7RUFDRTs7O0FBS0Y7RUFDRTtFQUNBOzs7QUFJSjtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTs7QUFHRjtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBOztBQUdGO0VBQ0U7RUFDQTs7QUFJSjtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUVBO0VBQ0U7O0FBR0Y7RUFDRTs7QUFJRjtFQUNFO0VBQ0E7RUFDQSIsInNvdXJjZXNDb250ZW50IjpbIi5leHBhbmQtYnV0dG9uIHtcbiAgcG9zaXRpb246IGFic29sdXRlO1xuICBkaXNwbGF5OiBmbGV4O1xuICBmbG9hdDogcmlnaHQ7XG4gIHBhZGRpbmc6IDAuNHJlbTtcbiAgbWFyZ2luOiAwLjNyZW07XG4gIHJpZ2h0OiAwOyAvLyBOT1RFOiByaWdodCB3aWxsIGJlIHNldCBpbiBtZXJtYWlkLmlubGluZS50c1xuICBjb2xvcjogdmFyKC0tZ3JheSk7XG4gIGJvcmRlci1jb2xvcjogdmFyKC0tZGFyayk7XG4gIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWxpZ2h0KTtcbiAgYm9yZGVyOiAxcHggc29saWQ7XG4gIGJvcmRlci1yYWRpdXM6IDVweDtcbiAgb3BhY2l0eTogMDtcbiAgdHJhbnNpdGlvbjogMC4ycztcblxuICAmID4gc3ZnIHtcbiAgICBmaWxsOiB2YXIoLS1saWdodCk7XG4gICAgZmlsdGVyOiBjb250cmFzdCgwLjMpO1xuICB9XG5cbiAgJjpob3ZlciB7XG4gICAgY3Vyc29yOiBwb2ludGVyO1xuICAgIGJvcmRlci1jb2xvcjogdmFyKC0tc2Vjb25kYXJ5KTtcbiAgfVxuXG4gICY6Zm9jdXMge1xuICAgIG91dGxpbmU6IDA7XG4gIH1cbn1cblxucHJlIHtcbiAgJjpob3ZlciA+IC5leHBhbmQtYnV0dG9uIHtcbiAgICBvcGFjaXR5OiAxO1xuICAgIHRyYW5zaXRpb246IDAuMnM7XG4gIH1cbn1cblxuI21lcm1haWQtY29udGFpbmVyIHtcbiAgcG9zaXRpb246IGZpeGVkO1xuICBjb250YWluOiBsYXlvdXQ7XG4gIHotaW5kZXg6IDk5OTtcbiAgbGVmdDogMDtcbiAgdG9wOiAwO1xuICB3aWR0aDogMTAwdnc7XG4gIGhlaWdodDogMTAwdmg7XG4gIG92ZXJmbG93OiBoaWRkZW47XG4gIGRpc3BsYXk6IG5vbmU7XG4gIGJhY2tkcm9wLWZpbHRlcjogYmx1cig0cHgpO1xuICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDAsIDAuNSk7XG5cbiAgJi5hY3RpdmUge1xuICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgfVxuXG4gICYgPiAjbWVybWFpZC1zcGFjZSB7XG4gICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tbGlnaHRncmF5KTtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1saWdodCk7XG4gICAgYm9yZGVyLXJhZGl1czogNXB4O1xuICAgIHBvc2l0aW9uOiBmaXhlZDtcbiAgICB0b3A6IDUwJTtcbiAgICBsZWZ0OiA1MCU7XG4gICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7XG4gICAgaGVpZ2h0OiA4MHZoO1xuICAgIHdpZHRoOiA4MHZ3O1xuICAgIG92ZXJmbG93OiBoaWRkZW47XG5cbiAgICAmID4gLm1lcm1haWQtY29udGVudCB7XG4gICAgICBwYWRkaW5nOiAycmVtO1xuICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgICAgdHJhbnNmb3JtLW9yaWdpbjogMCAwO1xuICAgICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDAuMXMgZWFzZTtcbiAgICAgIG92ZXJmbG93OiB2aXNpYmxlO1xuICAgICAgbWluLWhlaWdodDogMjAwcHg7XG4gICAgICBtaW4td2lkdGg6IDIwMHB4O1xuXG4gICAgICBwcmUge1xuICAgICAgICBtYXJnaW46IDA7XG4gICAgICAgIGJvcmRlcjogbm9uZTtcbiAgICAgIH1cblxuICAgICAgc3ZnIHtcbiAgICAgICAgbWF4LXdpZHRoOiBub25lO1xuICAgICAgICBoZWlnaHQ6IGF1dG87XG4gICAgICB9XG4gICAgfVxuXG4gICAgJiA+IC5tZXJtYWlkLWNvbnRyb2xzIHtcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgIGJvdHRvbTogMjBweDtcbiAgICAgIHJpZ2h0OiAyMHB4O1xuICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgIGdhcDogOHB4O1xuICAgICAgcGFkZGluZzogOHB4O1xuICAgICAgYmFja2dyb3VuZDogdmFyKC0tbGlnaHQpO1xuICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tbGlnaHRncmF5KTtcbiAgICAgIGJvcmRlci1yYWRpdXM6IDZweDtcbiAgICAgIGJveC1zaGFkb3c6IDAgMnB4IDRweCByZ2JhKDAsIDAsIDAsIDAuMSk7XG4gICAgICB6LWluZGV4OiAyO1xuXG4gICAgICAubWVybWFpZC1jb250cm9sLWJ1dHRvbiB7XG4gICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICAgICAgICB3aWR0aDogMzJweDtcbiAgICAgICAgaGVpZ2h0OiAzMnB4O1xuICAgICAgICBwYWRkaW5nOiAwO1xuICAgICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1saWdodGdyYXkpO1xuICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1saWdodCk7XG4gICAgICAgIGNvbG9yOiB2YXIoLS1kYXJrKTtcbiAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4O1xuICAgICAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgICAgIGZvbnQtc2l6ZTogMTZweDtcbiAgICAgICAgZm9udC1mYW1pbHk6IHZhcigtLWJvZHlGb250KTtcbiAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuMnMgZWFzZTtcblxuICAgICAgICAmOmhvdmVyIHtcbiAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1saWdodGdyYXkpO1xuICAgICAgICB9XG5cbiAgICAgICAgJjphY3RpdmUge1xuICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgxcHgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU3R5bGUgdGhlIHJlc2V0IGJ1dHRvbiBkaWZmZXJlbnRseVxuICAgICAgICAmOm50aC1jaGlsZCgyKSB7XG4gICAgICAgICAgd2lkdGg6IGF1dG87XG4gICAgICAgICAgcGFkZGluZzogMCAxMnB4O1xuICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl19 */</style><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="../../../../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../../../../static/contentIndex.json").then(data => data.json())</script><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://raibid-labs.github.io/docs/index.xml"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image" content="https://raibid-labs.github.io/docs/projects/mop/docs/research/grafana-stack-examples-og-image.webp"/><meta property="og:image:url" content="https://raibid-labs.github.io/docs/projects/mop/docs/research/grafana-stack-examples-og-image.webp"/><meta name="twitter:image" content="https://raibid-labs.github.io/docs/projects/mop/docs/research/grafana-stack-examples-og-image.webp"/><meta property="og:image:type" content="image/.webp"/></head><body data-slug="projects/mop/docs/research/grafana-stack-examples"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href="../../../..">Raibid Labs Documentation</a></h2><div class="spacer mobile-only"></div><div class="flex-component" style="flex-direction: row; flex-wrap: nowrap; gap: 1rem;"><div style="flex-grow: 1; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><div class="search"><button class="search-button"><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg><p>Search</p></button><div class="search-container"><div class="search-space"><input autocomplete="off" class="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div class="search-layout" data-preview="true"></div></div></div></div></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div style="flex-grow: 0; flex-shrink: 1; flex-basis: auto; order: 0; align-self: center; justify-self: center;"><button class="readermode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="readerIcon" fill="currentColor" stroke="currentColor" stroke-width="0.2" stroke-linecap="round" stroke-linejoin="round" width="64px" height="64px" viewBox="0 0 24 24" aria-label="Reader mode"><title>Reader mode</title><g transform="translate(-1.8, -1.8) scale(1.15, 1.2)"><path d="M8.9891247,2.5 C10.1384702,2.5 11.2209868,2.96705384 12.0049645,3.76669482 C12.7883914,2.96705384 13.8709081,2.5 15.0202536,2.5 L18.7549359,2.5 C19.1691495,2.5 19.5049359,2.83578644 19.5049359,3.25 L19.5046891,4.004 L21.2546891,4.00457396 C21.6343849,4.00457396 21.9481801,4.28672784 21.9978425,4.6528034 L22.0046891,4.75457396 L22.0046891,20.25 C22.0046891,20.6296958 21.7225353,20.943491 21.3564597,20.9931534 L21.2546891,21 L2.75468914,21 C2.37499337,21 2.06119817,20.7178461 2.01153575,20.3517706 L2.00468914,20.25 L2.00468914,4.75457396 C2.00468914,4.37487819 2.28684302,4.061083 2.65291858,4.01142057 L2.75468914,4.00457396 L4.50368914,4.004 L4.50444233,3.25 C4.50444233,2.87030423 4.78659621,2.55650904 5.15267177,2.50684662 L5.25444233,2.5 L8.9891247,2.5 Z M4.50368914,5.504 L3.50468914,5.504 L3.50468914,19.5 L10.9478955,19.4998273 C10.4513189,18.9207296 9.73864328,18.5588115 8.96709342,18.5065584 L8.77307039,18.5 L5.25444233,18.5 C4.87474657,18.5 4.56095137,18.2178461 4.51128895,17.8517706 L4.50444233,17.75 L4.50368914,5.504 Z M19.5049359,17.75 C19.5049359,18.1642136 19.1691495,18.5 18.7549359,18.5 L15.2363079,18.5 C14.3910149,18.5 13.5994408,18.8724714 13.0614828,19.4998273 L20.5046891,19.5 L20.5046891,5.504 L19.5046891,5.504 L19.5049359,17.75 Z M18.0059359,3.999 L15.0202536,4 L14.8259077,4.00692283 C13.9889509,4.06666544 13.2254227,4.50975805 12.7549359,5.212 L12.7549359,17.777 L12.7782651,17.7601316 C13.4923805,17.2719483 14.3447024,17 15.2363079,17 L18.0059359,16.999 L18.0056891,4.798 L18.0033792,4.75457396 L18.0056891,4.71 L18.0059359,3.999 Z M8.9891247,4 L6.00368914,3.999 L6.00599909,4.75457396 L6.00599909,4.75457396 L6.00368914,4.783 L6.00368914,16.999 L8.77307039,17 C9.57551536,17 10.3461406,17.2202781 11.0128313,17.6202194 L11.2536891,17.776 L11.2536891,5.211 C10.8200889,4.56369974 10.1361548,4.13636104 9.37521067,4.02745763 L9.18347055,4.00692283 L8.9891247,4 Z"></path></g></svg></button></div></div><div class="explorer" data-behavior="link" data-collapsed="collapsed" data-savestate="true" data-data-fns="{&quot;order&quot;:[&quot;filter&quot;,&quot;map&quot;,&quot;sort&quot;],&quot;sortFn&quot;:&quot;(a,b)=>!a.isFolder&amp;&amp;!b.isFolder||a.isFolder&amp;&amp;b.isFolder?a.displayName.localeCompare(b.displayName,void 0,{numeric:!0,sensitivity:\&quot;base\&quot;}):!a.isFolder&amp;&amp;b.isFolder?1:-1&quot;,&quot;filterFn&quot;:&quot;node=>node.slugSegment!==\&quot;tags\&quot;&quot;,&quot;mapFn&quot;:&quot;node=>node&quot;}"><button type="button" class="explorer-toggle mobile-explorer hide-until-loaded" data-mobile="true" aria-controls="explorer-387"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button><button type="button" class="title-button explorer-toggle desktop-explorer" data-mobile="false" aria-expanded="true"><h2>Explorer</h2><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-387" class="explorer-content" aria-expanded="false" role="group"><ul class="explorer-ul overflow" id="list-0"><li class="overflow-end"></li></ul></div><template id="template-file"><li><a href="#"></a></li></template><template id="template-folder"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div><button class="folder-button"><span class="folder-title"></span></button></div></div><div class="folder-outer"><ul class="content"></ul></div></li></template></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../../../../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../../../projects/">Projects</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../../../projects/mop/">mop</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../../../projects/mop/docs/">docs</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../../../projects/mop/docs/research/">research</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>grafana stack examples</a></div></nav><h1 class="article-title">grafana-stack-examples</h1><p show-comma="true" class="content-meta"><time datetime="2025-11-16T03:15:11.447Z">Nov 16, 2025</time><span>14 min read</span></p></div></div><article class="popover-hint"><h1 id="grafana-observability-stack-with-tanka-concrete-examples">Grafana Observability Stack with Tanka: Concrete Examples<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#grafana-observability-stack-with-tanka-concrete-examples" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<h2 id="overview">Overview<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#overview" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>This document provides production-ready examples for deploying the complete Grafana observability stack using Tanka and Jsonnet, including Loki, Mimir, Tempo, Prometheus, and Grafana.</p>
<hr/>
<h2 id="1-project-structure">1. Project Structure<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#1-project-structure" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<pre><code>mop/
├── jsonnetfile.json
├── jsonnetfile.lock.json
├── chartfile.yaml
│
├── environments/
│   ├── dev/
│   │   ├── main.jsonnet
│   │   └── spec.json
│   ├── staging/
│   │   ├── main.jsonnet
│   │   └── spec.json
│   └── production/
│       ├── main.jsonnet
│       └── spec.json
│
├── lib/
│   ├── k.libsonnet
│   ├── config.libsonnet         # Shared configuration
│   ├── grafana.libsonnet        # Grafana wrapper
│   ├── loki.libsonnet           # Loki wrapper
│   ├── mimir.libsonnet          # Mimir wrapper
│   ├── tempo.libsonnet          # Tempo wrapper
│   └── prometheus.libsonnet     # Prometheus wrapper
│
├── vendor/                       # Managed by jsonnet-bundler
│   └── github.com/
│       └── grafana/
│           └── jsonnet-libs/
│
└── charts/                       # Vendored Helm charts
    ├── grafana/
    ├── loki/
    ├── mimir-distributed/
    ├── tempo/
    └── prometheus/
</code></pre>
<hr/>
<h2 id="2-shared-configuration-library">2. Shared Configuration Library<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#2-shared-configuration-library" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="jsonnet" data-theme="github-light one-dark-pro"><code data-language="jsonnet" data-theme="github-light one-dark-pro" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// lib/config.libsonnet</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  new</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(environment)</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> envConfigs </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      dev:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        domain:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'dev.monitoring.local'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        storageClass:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'standard'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        retention:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          metrics:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '7d'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          logs:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '3d'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          traces:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '24h'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        resources:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          small:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">requests:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '100m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '256Mi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">limits:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '500m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '512Mi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          medium:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">requests:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '500m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '1Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">limits:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '1000m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '2Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          large:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">requests:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '1000m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '2Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">limits:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '2000m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '4Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        replicas:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">min:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">max:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        storage:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          prometheus:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '20Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          loki:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '30Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          mimir:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '50Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          tempo:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '20Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          grafana:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '5Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      staging:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        domain:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'staging.monitoring.example.com'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        storageClass:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'fast-ssd'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        retention:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          metrics:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '15d'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          logs:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '7d'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          traces:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '2d'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        resources:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          small:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">requests:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '250m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '512Mi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">limits:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '1000m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '1Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          medium:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">requests:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '1000m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '2Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">limits:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '2000m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '4Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          large:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">requests:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '2000m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '4Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">limits:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '4000m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '8Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        replicas:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">min:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">max:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        storage:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          prometheus:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '100Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          loki:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '100Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          mimir:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '200Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          tempo:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '50Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          grafana:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '10Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      production:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        domain:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'monitoring.example.com'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        storageClass:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'fast-ssd'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        retention:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          metrics:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '30d'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          logs:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '14d'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          traces:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '7d'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        resources:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          small:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">requests:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '500m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '1Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">limits:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '2000m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '2Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          medium:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">requests:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '2000m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '4Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">limits:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '4000m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '8Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          large:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">requests:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '4000m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '8Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">limits:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">cpu:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '8000m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">memory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '16Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> } },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        replicas:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">min:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">max:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        storage:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          prometheus:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '500Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          loki:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '500Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          mimir:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '1Ti'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          tempo:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '200Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          grafana:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '20Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> cfg </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> envConfigs[environment],</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    environment:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> environment,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    namespace:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'monitoring'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    domain:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> cfg.domain,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    storageClass:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> cfg.storageClass,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    retention:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> cfg.retention,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    resources:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> cfg.resources,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    replicas:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> cfg.replicas,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    storage:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> cfg.storage,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // S3 configuration (environment variables or secrets)</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    s3:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      endpoint:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 's3.amazonaws.com'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      region:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'us-east-1'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      buckets:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        loki:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'mop-loki-'</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> environment,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        mimir:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'mop-mimir-'</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> environment,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        tempo:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'mop-tempo-'</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> environment,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // Common labels</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    labels:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      environment:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> environment,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      'app.kubernetes.io/managed-by'</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'tanka'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      'app.kubernetes.io/part-of'</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'grafana-stack'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // TLS configuration</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    tls:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      enabled:</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> environment </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'production'</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> then</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> else</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      secretName:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'monitoring-tls'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre></figure>
<hr/>
<h2 id="3-loki-configuration">3. Loki Configuration<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#3-loki-configuration" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="jsonnet" data-theme="github-light one-dark-pro"><code data-language="jsonnet" data-theme="github-light one-dark-pro" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// lib/loki.libsonnet</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tanka </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'github.com/grafana/jsonnet-libs/tanka-util/main.libsonnet'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> helm </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tanka.helm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">std.thisFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  new</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(config)</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> lokiConfig </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      auth_enabled:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      server:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        http_listen_port:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        grpc_listen_port:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 9095</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        log_level:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'info'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      common:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        path_prefix:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '/loki'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        replication_factor:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        storage:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          s3:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">            endpoint:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> config.s3.endpoint,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">            region:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> config.s3.region,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">            bucketnames:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> config.s3.buckets.loki,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">            s3forcepathstyle:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      schema_config:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        configs:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">            from:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '2024-01-01'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">            store:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'tsdb'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">            object_store:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 's3'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">            schema:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'v13'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">            index:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">              prefix:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'loki_index_'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">              period:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '24h'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        ],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      limits_config:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        retention_period:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> config.retention.logs,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        ingestion_rate_strategy:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'global'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        ingestion_rate_mb:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        ingestion_burst_size_mb:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 20</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        max_query_length:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '721h'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,  </span><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// 30 days</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        max_query_parallelism:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 16</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        max_streams_per_user:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        max_global_streams_per_user:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 50000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        reject_old_samples:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        reject_old_samples_max_age:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '168h'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        split_queries_by_interval:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '15m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      compactor:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        working_directory:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '/loki/compactor'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        shared_store:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 's3'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        compaction_interval:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '10m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        retention_enabled:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        retention_delete_delay:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '2h'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        retention_delete_worker_count:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 150</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      query_range:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        results_cache:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          cache:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">            embedded_cache:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">              enabled:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">              max_size_mb:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 500</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      ruler:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        storage:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          type:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 's3'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          s3:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">            bucketnames:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> config.s3.buckets.loki </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '-ruler'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        rule_path:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '/tmp/loki/rules'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        alertmanager_url:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'http://alertmanager:9093'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        enable_api:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        enable_alertmanager_v2:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      frontend:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        compress_responses:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        max_outstanding_per_tenant:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2048</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      ingester:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        lifecycler:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          ring:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">            kvstore:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">              store:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'memberlist'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">            replication_factor:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        chunk_idle_period:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '30m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        chunk_block_size:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 262144</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        chunk_encoding:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'snappy'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        chunk_retain_period:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '1m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        max_chunk_age:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '1h'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        wal:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          enabled:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          dir:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '/loki/wal'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    loki:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> helm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'loki'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'../charts/loki'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      namespace: config.namespace,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      values: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        loki: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          image: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            repository: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'grafana/loki'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            tag: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'2.9.3'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          config: std.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">manifestYamlDoc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(lokiConfig),</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          structuredConfig: lokiConfig,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          persistence: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            size: config.storage.loki,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            storageClassName: config.storageClass,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Gateway (nginx)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        gateway: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.small,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          ingress: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            hosts: [{</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              host: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'loki.'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> + config.domain,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              paths: [{ path: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'/'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, pathType: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'Prefix'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            tls: if config.tls.enabled then [{</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              secretName: config.tls.secretName,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              hosts: [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'loki.'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> + config.domain],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }] else [],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Write path (distributor, ingester)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        write: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.medium,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          persistence: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            size: config.storage.loki,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            storageClass: config.storageClass,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Read path (query-frontend, querier)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        read: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.medium,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Backend (compactor, index-gateway, ruler)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        backend: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.medium,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          persistence: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            size: config.storage.loki,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            storageClass: config.storageClass,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Monitoring</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        monitoring: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          serviceMonitor: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            labels: config.labels,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          selfMonitoring: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            grafanaAgent: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              installOperator: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }),</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    // Add custom annotations for cost tracking</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    result:</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.loki </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      deployment_loki_write+:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">        metadata+:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">          annotations+:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            'cost-center'</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'observability'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            'data-classification'</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'internal'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre></figure>
<hr/>
<h2 id="4-mimir-configuration">4. Mimir Configuration<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#4-mimir-configuration" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="jsonnet" data-theme="github-light one-dark-pro"><code data-language="jsonnet" data-theme="github-light one-dark-pro" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// lib/mimir.libsonnet</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tanka </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'github.com/grafana/jsonnet-libs/tanka-util/main.libsonnet'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> helm </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tanka.helm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">std.thisFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  new</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(config)</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    mimir:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> helm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'mimir'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'../charts/mimir-distributed'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      namespace: config.namespace,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      values: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        global: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          clusterDomain: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'cluster.local'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        mimir: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          structuredConfig: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            multitenancy_enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            server: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              log_level: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'info'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              http_listen_port: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              grpc_listen_port: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">9095</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            common: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              storage: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                backend: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'s3'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                s3: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  endpoint: config.s3.endpoint,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  region: config.s3.region,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  bucket_name: config.s3.buckets.mimir,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            blocks_storage: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              backend: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'s3'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              s3: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                endpoint: config.s3.endpoint,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                region: config.s3.region,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                bucket_name: config.s3.buckets.mimir + </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'-blocks'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              tsdb: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                dir: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'/data/tsdb'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                retention_period: config.retention.metrics,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            compactor: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              compaction_interval: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'30m'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              deletion_delay: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'2h'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              max_opening_blocks_concurrency: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              max_closing_blocks_concurrency: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              symbols_flushers_concurrency: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              data_dir: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'/data/compactor'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            distributor: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              ring: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                kvstore: { store: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'memberlist'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            ingester: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              ring: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                kvstore: { store: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'memberlist'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                replication_factor: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            ruler_storage: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              backend: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'s3'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              s3: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                bucket_name: config.s3.buckets.mimir + </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'-ruler'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            alertmanager_storage: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              backend: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'s3'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              s3: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                bucket_name: config.s3.buckets.mimir + </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'-alertmanager'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            limits: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              max_label_names_per_series: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              max_global_series_per_user: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1500000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              max_global_series_per_metric: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">300000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              ingestion_rate: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              ingestion_burst_size: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">200000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Distributor</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        distributor: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.medium,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Ingester</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        ingester: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min * </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,  </span><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// More ingesters for better distribution</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.large,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          persistentVolume: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            size: config.storage.mimir,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            storageClass: config.storageClass,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          zoneAwareReplication: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            enabled: config.environment == </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'production'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Querier</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        querier: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.medium,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Query Frontend</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        query_frontend: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.medium,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Query Scheduler</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        query_scheduler: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.small,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Store Gateway</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        store_gateway: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.large,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          persistentVolume: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            size: config.storage.mimir,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            storageClass: config.storageClass,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          zoneAwareReplication: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            enabled: config.environment == </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'production'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Compactor</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        compactor: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.large,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          persistentVolume: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            size: config.storage.mimir,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            storageClass: config.storageClass,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Ruler</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        ruler: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.medium,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Alertmanager</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        alertmanager: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.small,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          persistentVolume: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            size: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'10Gi'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            storageClass: config.storageClass,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Nginx gateway</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        nginx: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.small,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          ingress: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            hosts: [{</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              host: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'mimir.'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> + config.domain,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              paths: [{ path: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'/'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, pathType: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'Prefix'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            tls: if config.tls.enabled then [{</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              secretName: config.tls.secretName,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              hosts: [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'mimir.'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> + config.domain],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }] else [],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Memcached for caching</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        memcached: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.medium,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Monitoring</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        serviceMonitor: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          labels: config.labels,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }),</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre></figure>
<hr/>
<h2 id="5-tempo-configuration">5. Tempo Configuration<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#5-tempo-configuration" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="jsonnet" data-theme="github-light one-dark-pro"><code data-language="jsonnet" data-theme="github-light one-dark-pro" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// lib/tempo.libsonnet</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tanka </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'github.com/grafana/jsonnet-libs/tanka-util/main.libsonnet'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> helm </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tanka.helm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">std.thisFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  new</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(config)</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    tempo:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> helm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'tempo'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'../charts/tempo'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      namespace: config.namespace,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      values: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        tempo: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          repository: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'grafana/tempo'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          tag: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'2.3.1'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          retention: config.retention.traces,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          metricsGenerator: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            remoteWriteUrl: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'http://mimir-nginx/api/v1/push'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          storage: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            trace: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              backend: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'s3'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              s3: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                bucket: config.s3.buckets.tempo,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                endpoint: config.s3.endpoint + </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">':443'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                region: config.s3.region,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                forcepathstyle: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              wal: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                path: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'/var/tempo/wal'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              pool: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                max_workers: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                queue_depth: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">10000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          receivers: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            jaeger: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              protocols: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                grpc: { endpoint: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'0.0.0.0:14250'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                thrift_binary: { endpoint: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'0.0.0.0:6832'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                thrift_compact: { endpoint: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'0.0.0.0:6831'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                thrift_http: { endpoint: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'0.0.0.0:14268'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            zipkin: { endpoint: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'0.0.0.0:9411'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            otlp: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              protocols: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                grpc: { endpoint: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'0.0.0.0:4317'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                http: { endpoint: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'0.0.0.0:4318'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            opencensus: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          overrides: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            metrics_generator_processors: [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'service-graphs'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'span-metrics'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Distributor</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        distributor: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.medium,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Ingester</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        ingester: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.large,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          persistence: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            size: config.storage.tempo,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            storageClass: config.storageClass,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Querier</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        querier: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.medium,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Query Frontend</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        queryFrontend: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.medium,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Compactor</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        compactor: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.large,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          persistence: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            size: config.storage.tempo,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            storageClass: config.storageClass,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Metrics Generator</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        metricsGenerator: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.medium,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Gateway</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        gateway: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.small,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          ingress: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            hosts: [{</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              host: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'tempo.'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> + config.domain,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              paths: [{ path: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'/'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, pathType: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'Prefix'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            tls: if config.tls.enabled then [{</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              secretName: config.tls.secretName,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              hosts: [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'tempo.'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> + config.domain],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }] else [],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Monitoring</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        serviceMonitor: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          labels: config.labels,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Memcached</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        memcached: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          replicas: config.replicas.min,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          resources: config.resources.small,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }),</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre></figure>
<hr/>
<h2 id="6-grafana-configuration">6. Grafana Configuration<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#6-grafana-configuration" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="jsonnet" data-theme="github-light one-dark-pro"><code data-language="jsonnet" data-theme="github-light one-dark-pro" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// lib/grafana.libsonnet</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tanka </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'github.com/grafana/jsonnet-libs/tanka-util/main.libsonnet'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> helm </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tanka.helm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">std.thisFile</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  new</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(config)</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    grafana:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> helm.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'grafana'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'../charts/grafana'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      namespace: config.namespace,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      values: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        replicas: config.replicas.min,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        image: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          repository: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'grafana/grafana'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          tag: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'10.2.2'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        resources: config.resources.medium,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        persistence: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          size: config.storage.grafana,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          storageClass: config.storageClass,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Admin credentials (use secrets in production)</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        adminUser: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'admin'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        adminPassword: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'changeme'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Grafana configuration</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        'grafana.ini'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          server: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            root_url: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'https://'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> + config.domain,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            domain: config.domain,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          security: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            admin_user: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'admin'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            cookie_secure: config.tls.enabled,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            strict_transport_security: config.tls.enabled,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          auth: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            disable_login_form: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            oauth_auto_login: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          'auth.anonymous'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          analytics: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            reporting_enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            check_for_updates: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          snapshots: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            external_enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          users: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            allow_sign_up: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            auto_assign_org: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            auto_assign_org_role: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'Viewer'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          log: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            mode: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'console'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            level: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'info'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          database: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            type: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'postgres'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            host: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'postgresql:5432'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            name: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'grafana'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            user: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'grafana'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            password: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'$__env{GF_DATABASE_PASSWORD}'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Datasources</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        datasources: {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          'datasources.yaml'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            apiVersion: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            datasources: [</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                name: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'Mimir'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                type: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'prometheus'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                url: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'http://mimir-nginx.'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> + config.namespace + </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'.svc.cluster.local/prometheus'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                access: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'proxy'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                isDefault: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                jsonData: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  timeInterval: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'30s'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  httpMethod: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'POST'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                editable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                name: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'Loki'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                type: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'loki'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                url: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'http://loki-gateway.'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> + config.namespace + </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'.svc.cluster.local'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                access: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'proxy'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                jsonData: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  maxLines: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  derivedFields: [</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                      datasourceUid: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'tempo'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                      matcherRegex: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'&quot;trace_id&quot;:&quot;(</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">w+)&quot;'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                      name: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'TraceID'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                      url: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'$${__value.raw}'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  ],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                editable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                name: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'Tempo'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                type: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'tempo'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                url: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'http://tempo-gateway.'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> + config.namespace + </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'.svc.cluster.local'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                access: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'proxy'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                jsonData: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  httpMethod: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'GET'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  tracesToLogs: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    datasourceUid: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'loki'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    tags: [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'job'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'instance'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'pod'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'namespace'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    mappedTags: [{ key: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'service.name'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, value: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'service'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    mapTagNamesEnabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    spanStartTimeShift: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'-1h'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    spanEndTimeShift: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'1h'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    filterByTraceID: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    filterBySpanID: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  tracesToMetrics: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    datasourceUid: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'mimir'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    tags: [{ key: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'service.name'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, value: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'service'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> }],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    queries: [</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                      {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        name: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'Sample query'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        query: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'sum(rate(tempo_spanmetrics_latency_bucket{$__tags}[5m]))'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                      },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    ],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  serviceMap: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    datasourceUid: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'mimir'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  nodeGraph: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  search: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    hide: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  lokiSearch: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                    datasourceUid: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'loki'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                editable: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            ],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Dashboard providers</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        dashboardProviders: {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          'dashboardproviders.yaml'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            apiVersion: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            providers: [</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                name: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'default'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                orgId: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                folder: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">''</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                type: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'file'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                disableDeletion: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                updateIntervalSeconds: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                allowUiUpdates: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                options: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  path: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'/var/lib/grafana/dashboards/default'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                name: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'observability'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                orgId: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                folder: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'Observability Stack'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                type: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'file'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                disableDeletion: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                options: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                  path: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'/var/lib/grafana/dashboards/observability'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            ],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Pre-installed dashboards</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        dashboards: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          default: {},</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          observability: {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            'loki-overview'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              gnetId: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">13639</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              revision: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              datasource: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'Loki'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            'mimir-overview'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              gnetId: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">19125</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              revision: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              datasource: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'Mimir'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            'tempo-overview'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              gnetId: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">16369</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              revision: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">              datasource: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'Tempo'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Plugins</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        plugins: [</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          'grafana-clock-panel'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          'grafana-piechart-panel'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          'grafana-worldmap-panel'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        ],</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Environment variables</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        env: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          GF_EXPLORE_ENABLED: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'true'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          GF_PANELS_DISABLE_SANITIZE_HTML: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'true'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          GF_LOG_FILTERS: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'rendering:debug'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Ingress</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        ingress: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          hosts: [config.domain],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          path: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'/'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          pathType: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'Prefix'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          tls: if config.tls.enabled then [{</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            secretName: config.tls.secretName,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            hosts: [config.domain],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          }] else [],</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          annotations: {</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            'kubernetes.io/ingress.class'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'nginx'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            'cert-manager.io/cluster-issuer'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'letsencrypt-prod'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            'nginx.ingress.kubernetes.io/force-ssl-redirect'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'true'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // Service Monitor</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        serviceMonitor: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          enabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          labels: config.labels,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        // RBAC</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        rbac: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          create: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          pspEnabled: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        serviceAccount: {</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          create: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          name: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'grafana'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }),</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre></figure>
<hr/>
<h2 id="7-production-environment-example">7. Production Environment Example<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#7-production-environment-example" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="jsonnet" data-theme="github-light one-dark-pro"><code data-language="jsonnet" data-theme="github-light one-dark-pro" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// environments/production/main.jsonnet</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> config </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '../../lib/config.libsonnet'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> grafana </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '../../lib/grafana.libsonnet'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> loki </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '../../lib/loki.libsonnet'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> mimir </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '../../lib/mimir.libsonnet'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tempo </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '../../lib/tempo.libsonnet'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> env </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> config.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">'production'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">  _config::</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> env,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Deploy complete stack</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">  loki:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> loki.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(env).result,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">  mimir:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> mimir.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(env).mimir,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">  tempo:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> tempo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(env).tempo,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">  grafana:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> grafana.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(env).grafana,</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Additional namespace resources</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">  namespace:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    apiVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'v1'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    kind:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'Namespace'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    metadata:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      name:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> env.namespace,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      labels:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> env.labels,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  // Storage class (if custom)</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">  storageClass:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    apiVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'storage.k8s.io/v1'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    kind:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'StorageClass'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    metadata:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      name:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> env.storageClass,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    provisioner:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'kubernetes.io/aws-ebs'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    parameters:</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      type:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'gp3'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      iops:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '3000'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">      throughput:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '125'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    allowVolumeExpansion:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#E36209;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;">    reclaimPolicy:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'Retain'</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="json" data-theme="github-light one-dark-pro"><code data-language="json" data-theme="github-light one-dark-pro" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">// environments/production/spec.json</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;apiVersion&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tanka.dev/v1alpha1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;kind&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Environment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;environments/production&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  },</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;spec&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;apiServer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;https://prod-k8s.example.com:6443&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;namespace&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;monitoring&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;resourceDefaults&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">      &quot;labels&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">        &quot;environment&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;production&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">        &quot;managed-by&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;tanka&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      }</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    },</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;expectVersions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">      &quot;kubernetes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;1.28.0&quot;</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>
<span data-line><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre></figure>
<hr/>
<h2 id="8-deployment-commands">8. Deployment Commands<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#8-deployment-commands" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light one-dark-pro"><code data-language="bash" data-theme="github-light one-dark-pro" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Initialize project</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> init</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --k8s=1.28</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> environments/production</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Install dependencies</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">jb</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> github.com/grafana/jsonnet-libs/tanka-util</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">jb</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> github.com/grafana/jsonnet-libs/ksonnet-util</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Setup Helm charts</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> charts</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> init</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> charts</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> add-repo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> grafana</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://grafana.github.io/helm-charts</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> charts</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> grafana/grafana@7.0.0</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> charts</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> grafana/loki@5.41.4</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> charts</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> grafana/mimir-distributed@5.1.3</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> charts</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> grafana/tempo@1.7.1</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tool</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> charts</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> vendor</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Preview changes</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> diff</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> environments/production</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Show full manifests</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> show</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> environments/production</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Apply to cluster</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> apply</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> environments/production</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Apply specific component</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> apply</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> environments/production</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --target=grafana</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Check status</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pods</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> svc</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ingress</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># View logs</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.kubernetes.io/name=grafana</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --tail=100</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.kubernetes.io/name=loki-write</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --tail=100</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.kubernetes.io/name=mimir-ingester</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --tail=100</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Delete environment</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> delete</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> environments/production</span></span></code></pre></figure>
<hr/>
<h2 id="9-testing--validation">9. Testing &amp; Validation<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#9-testing--validation" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light one-dark-pro"><code data-language="bash" data-theme="github-light one-dark-pro" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Test Loki</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  -XPOST</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://loki.monitoring.example.com/loki/api/v1/push</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  --data-raw</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> '{&quot;streams&quot;: [{ &quot;stream&quot;: { &quot;foo&quot;: &quot;bar&quot; }, &quot;values&quot;: [ [ &quot;1640000000000000000&quot;, &quot;test log line&quot; ] ] }]}'</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Query Loki</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -G</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;https://loki.monitoring.example.com/loki/api/v1/query&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  --data-urlencode</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'query={foo=&quot;bar&quot;}'</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Test Mimir (Prometheus remote write)</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://mimir.monitoring.example.com/api/v1/push</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Content-Type: application/x-protobuf&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  --data-binary</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> @metrics.pb</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Query Mimir</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -G</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://mimir.monitoring.example.com/prometheus/api/v1/query</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  --data-urlencode</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 'query=up'</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Test Tempo (send trace)</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -X</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> POST</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://tempo.monitoring.example.com/v1/traces</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  -H</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Content-Type: application/json&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \</span></span>
<span data-line><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  -d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> @trace.json</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Access Grafana</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">open</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://monitoring.example.com</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Port-forward for local testing</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> port-forward</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> svc/grafana</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 3000:80</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> port-forward</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> svc/loki-gateway</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 3100:80</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> port-forward</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> svc/mimir-nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 8080:80</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> port-forward</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> svc/tempo-gateway</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 3200:80</span></span></code></pre></figure>
<hr/>
<h2 id="10-monitoring--operations">10. Monitoring &amp; Operations<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#10-monitoring--operations" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light one-dark-pro"><code data-language="bash" data-theme="github-light one-dark-pro" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># View metrics</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> top</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pods</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> top</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nodes</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Check resource usage</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> node</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -A</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Allocated resources&quot;</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Scale components</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> scale</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> deployment</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> grafana</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --replicas=3</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> scale</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> statefulset</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> loki-write</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --replicas=4</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Update configuration</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> apply</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> environments/production</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --diff</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Rollback</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rollout</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> undo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> deployment/grafana</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rollout</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> deployment/grafana</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Backup</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> all</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yaml</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> ></span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring-backup.yaml</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Check logs for errors</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.kubernetes.io/name=loki-write</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ERROR</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.kubernetes.io/name=mimir-ingester</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ERROR</span></span></code></pre></figure>
<hr/>
<h2 id="11-troubleshooting-common-issues">11. Troubleshooting Common Issues<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#11-troubleshooting-common-issues" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<h3 id="loki-not-receiving-logs">Loki not receiving logs<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#loki-not-receiving-logs" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light one-dark-pro"><code data-language="bash" data-theme="github-light one-dark-pro" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Check promtail</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.kubernetes.io/name=promtail</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Verify service connectivity</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> promtail-xxxxx</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -O-</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://loki-gateway/ready</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Check ingester ring</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://loki.monitoring.example.com/ring</span></span></code></pre></figure>
<h3 id="mimir-ingestion-issues">Mimir ingestion issues<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#mimir-ingestion-issues" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light one-dark-pro"><code data-language="bash" data-theme="github-light one-dark-pro" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Check distributor logs</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.kubernetes.io/name=mimir-distributor</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Verify S3 access</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> exec</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -it</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mimir-ingester-0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> aws</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> s3</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ls</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> s3://mop-mimir-production/</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Check memberlist</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mimir-ingester-0</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> memberlist</span></span></code></pre></figure>
<h3 id="tempo-trace-ingestion">Tempo trace ingestion<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#tempo-trace-ingestion" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<figure data-rehype-pretty-code-figure><pre tabindex="0" data-language="bash" data-theme="github-light one-dark-pro"><code data-language="bash" data-theme="github-light one-dark-pro" style="display:grid;"><span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Test receivers</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> port-forward</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> svc/tempo-distributor</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 4317:4317</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">grpcurl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -plaintext</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> localhost:4317</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> list</span></span>
<span data-line> </span>
<span data-line><span style="--shiki-light:#6A737D;--shiki-light-font-style:inherit;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Check ingester</span></span>
<span data-line><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> monitoring</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> app.kubernetes.io/name=tempo-ingester</span></span></code></pre></figure>
<hr/>
<h2 id="summary">Summary<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#summary" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>This configuration provides:</p>
<ul>
<li><strong>Complete observability stack</strong> with Loki, Mimir, Tempo, and Grafana</li>
<li><strong>Production-ready</strong> with proper sizing, persistence, and HA</li>
<li><strong>Environment-specific</strong> configurations (dev, staging, production)</li>
<li><strong>Modular architecture</strong> with reusable libraries</li>
<li><strong>Integrated dashboards</strong> and datasources</li>
<li><strong>Proper resource management</strong> and scaling</li>
<li><strong>Security</strong> with TLS, RBAC, and secrets</li>
<li><strong>Monitoring</strong> with ServiceMonitors</li>
</ul>
<p>All components are deeply integrated with trace-to-logs, logs-to-metrics, and metrics-to-traces correlation.</p></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div class="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false,&quot;enableRadial&quot;:false}"></div><button class="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div class="global-graph-outer"><div class="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.2,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true,&quot;enableRadial&quot;:true}"></div></div></div><div class="toc desktop-only"><button type="button" class="toc-header" aria-controls="toc-177" aria-expanded="true"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><ul id="list-1" class="toc-content overflow"><li class="depth-0"><a href="#grafana-observability-stack-with-tanka-concrete-examples" data-for="grafana-observability-stack-with-tanka-concrete-examples">Grafana Observability Stack with Tanka: Concrete Examples</a></li><li class="depth-1"><a href="#overview" data-for="overview">Overview</a></li><li class="depth-1"><a href="#1-project-structure" data-for="1-project-structure">1. Project Structure</a></li><li class="depth-1"><a href="#2-shared-configuration-library" data-for="2-shared-configuration-library">2. Shared Configuration Library</a></li><li class="depth-1"><a href="#3-loki-configuration" data-for="3-loki-configuration">3. Loki Configuration</a></li><li class="depth-1"><a href="#4-mimir-configuration" data-for="4-mimir-configuration">4. Mimir Configuration</a></li><li class="depth-1"><a href="#5-tempo-configuration" data-for="5-tempo-configuration">5. Tempo Configuration</a></li><li class="depth-1"><a href="#6-grafana-configuration" data-for="6-grafana-configuration">6. Grafana Configuration</a></li><li class="depth-1"><a href="#7-production-environment-example" data-for="7-production-environment-example">7. Production Environment Example</a></li><li class="depth-1"><a href="#8-deployment-commands" data-for="8-deployment-commands">8. Deployment Commands</a></li><li class="depth-1"><a href="#9-testing--validation" data-for="9-testing--validation">9. Testing &amp; Validation</a></li><li class="depth-1"><a href="#10-monitoring--operations" data-for="10-monitoring--operations">10. Monitoring &amp; Operations</a></li><li class="depth-1"><a href="#11-troubleshooting-common-issues" data-for="11-troubleshooting-common-issues">11. Troubleshooting Common Issues</a></li><li class="depth-2"><a href="#loki-not-receiving-logs" data-for="loki-not-receiving-logs">Loki not receiving logs</a></li><li class="depth-2"><a href="#mimir-ingestion-issues" data-for="mimir-ingestion-issues">Mimir ingestion issues</a></li><li class="depth-2"><a href="#tempo-trace-ingestion" data-for="tempo-trace-ingestion">Tempo trace ingestion</a></li><li class="depth-1"><a href="#summary" data-for="summary">Summary</a></li><li class="overflow-end"></li></ul></div><div class="backlinks"><h3>Backlinks</h3><ul id="list-2" class="overflow"><li><a href="../../../../projects/mop/docs/research/README" class="internal">README</a></li><li class="overflow-end"></li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.5.2</a> © 2025</p><ul><li><a href="https://github.com/raibid-labs">Raibid Labs</a></li><li><a href="https://github.com/raibid-labs/docs">Documentation Hub</a></li></ul></footer></div></div></body><script type="application/javascript">function n(){let t=this.parentElement;t.classList.toggle("is-collapsed");let e=t.getElementsByClassName("callout-content")[0];if(!e)return;let l=t.classList.contains("is-collapsed");e.style.gridTemplateRows=l?"0fr":"1fr"}function c(){let t=document.getElementsByClassName("callout is-collapsible");for(let e of t){let l=e.getElementsByClassName("callout-title")[0],s=e.getElementsByClassName("callout-content")[0];if(!l||!s)continue;l.addEventListener("click",n),window.addCleanup(()=>l.removeEventListener("click",n));let o=e.classList.contains("is-collapsed");s.style.gridTemplateRows=o?"0fr":"1fr"}}document.addEventListener("nav",c);
</script><script type="module">function f(i,e){if(!i)return;function r(o){o.target===this&&(o.preventDefault(),o.stopPropagation(),e())}function t(o){o.key.startsWith("Esc")&&(o.preventDefault(),e())}i?.addEventListener("click",r),window.addCleanup(()=>i?.removeEventListener("click",r)),document.addEventListener("keydown",t),window.addCleanup(()=>document.removeEventListener("keydown",t))}function y(i){for(;i.firstChild;)i.removeChild(i.firstChild)}var h=class{constructor(e,r){this.container=e;this.content=r;this.setupEventListeners(),this.setupNavigationControls(),this.resetTransform()}isDragging=!1;startPan={x:0,y:0};currentPan={x:0,y:0};scale=1;MIN_SCALE=.5;MAX_SCALE=3;cleanups=[];setupEventListeners(){let e=this.onMouseDown.bind(this),r=this.onMouseMove.bind(this),t=this.onMouseUp.bind(this),o=this.resetTransform.bind(this);this.container.addEventListener("mousedown",e),document.addEventListener("mousemove",r),document.addEventListener("mouseup",t),window.addEventListener("resize",o),this.cleanups.push(()=>this.container.removeEventListener("mousedown",e),()=>document.removeEventListener("mousemove",r),()=>document.removeEventListener("mouseup",t),()=>window.removeEventListener("resize",o))}cleanup(){for(let e of this.cleanups)e()}setupNavigationControls(){let e=document.createElement("div");e.className="mermaid-controls";let r=this.createButton("+",()=>this.zoom(.1)),t=this.createButton("-",()=>this.zoom(-.1)),o=this.createButton("Reset",()=>this.resetTransform());e.appendChild(t),e.appendChild(o),e.appendChild(r),this.container.appendChild(e)}createButton(e,r){let t=document.createElement("button");return t.textContent=e,t.className="mermaid-control-button",t.addEventListener("click",r),window.addCleanup(()=>t.removeEventListener("click",r)),t}onMouseDown(e){e.button===0&&(this.isDragging=!0,this.startPan={x:e.clientX-this.currentPan.x,y:e.clientY-this.currentPan.y},this.container.style.cursor="grabbing")}onMouseMove(e){this.isDragging&&(e.preventDefault(),this.currentPan={x:e.clientX-this.startPan.x,y:e.clientY-this.startPan.y},this.updateTransform())}onMouseUp(){this.isDragging=!1,this.container.style.cursor="grab"}zoom(e){let r=Math.min(Math.max(this.scale+e,this.MIN_SCALE),this.MAX_SCALE),t=this.content.getBoundingClientRect(),o=t.width/2,n=t.height/2,c=r-this.scale;this.currentPan.x-=o*c,this.currentPan.y-=n*c,this.scale=r,this.updateTransform()}updateTransform(){this.content.style.transform=`translate(${this.currentPan.x}px, ${this.currentPan.y}px) scale(${this.scale})`}resetTransform(){this.scale=1;let e=this.content.querySelector("svg");this.currentPan={x:e.getBoundingClientRect().width/2,y:e.getBoundingClientRect().height/2},this.updateTransform()}},C=["--secondary","--tertiary","--gray","--light","--lightgray","--highlight","--dark","--darkgray","--codeFont"],E;document.addEventListener("nav",async()=>{let e=document.querySelector(".center").querySelectorAll("code.mermaid");if(e.length===0)return;E||=await import("https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.esm.min.mjs");let r=E.default,t=new WeakMap;for(let n of e)t.set(n,n.innerText);async function o(){for(let s of e){s.removeAttribute("data-processed");let a=t.get(s);a&&(s.innerHTML=a)}let n=C.reduce((s,a)=>(s[a]=window.getComputedStyle(document.documentElement).getPropertyValue(a),s),{}),c=document.documentElement.getAttribute("saved-theme")==="dark";r.initialize({startOnLoad:!1,securityLevel:"loose",theme:c?"dark":"base",themeVariables:{fontFamily:n["--codeFont"],primaryColor:n["--light"],primaryTextColor:n["--darkgray"],primaryBorderColor:n["--tertiary"],lineColor:n["--darkgray"],secondaryColor:n["--secondary"],tertiaryColor:n["--tertiary"],clusterBkg:n["--light"],edgeLabelBackground:n["--highlight"]}}),await r.run({nodes:e})}await o(),document.addEventListener("themechange",o),window.addCleanup(()=>document.removeEventListener("themechange",o));for(let n=0;n<e.length;n++){let v=function(){let g=l.querySelector("#mermaid-space"),m=l.querySelector(".mermaid-content");if(!m)return;y(m);let w=c.querySelector("svg").cloneNode(!0);m.appendChild(w),l.classList.add("active"),g.style.cursor="grab",u=new h(g,m)},M=function(){l.classList.remove("active"),u?.cleanup(),u=null},c=e[n],s=c.parentElement,a=s.querySelector(".clipboard-button"),d=s.querySelector(".expand-button"),p=window.getComputedStyle(a),L=a.offsetWidth+parseFloat(p.marginLeft||"0")+parseFloat(p.marginRight||"0");d.style.right=`calc(${L}px + 0.3rem)`,s.prepend(d);let l=s.querySelector("#mermaid-container");if(!l)return;let u=null;d.addEventListener("click",v),f(l,M),window.addCleanup(()=>{u?.cleanup(),d.removeEventListener("click",v)})}});
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="../../../../postscript.js" type="module"></script></html>